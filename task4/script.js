let photoPosts = [
    {
        id: '1',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-31T00:00:00'),
        author: 'Бутырчик Андрей',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#hashtag', '#summer'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '2',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-24T23:00:00'),
        author: 'Валай Александр',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#hashtag', '#summer'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '3',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-20T23:00:00'),
        author: 'Гаврушко Дмитрий',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#hashtag', '#summer'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '4',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-24T23:00:00'),
        author: 'Глушук Филипп',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#hashtag', '#summer'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '5',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-10T23:00:00'),
        author: 'Гришин Никита',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#hashtag', '#summer', 'weekend'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '6',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-08T23:00:00'),
        author: 'Гусаковский Александр',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#hashtag', '#summer'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '7',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-11T23:00:00'),
        author: 'Гущенскова Александра',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#hashtag', '#summer', '#weekend'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '8',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-01T23:00:00'),
        author: 'Жукова Екатерина',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#hashtag', '#summer', '#weekend'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '9',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-23T23:00:00'),
        author: 'Кетко Евгения',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#hashtag', '#summer', '#weekend'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '10',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-18T23:00:00'),
        author: 'Котусев Дмитрий',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#hashtag', '#summer', '#monday'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '11',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-24T23:00:00'),
        author: 'Кузьмик Александр',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#hashtag', '#summer', '#monday'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '12',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-20T23:00:00'),
        author: 'Наумов Даниил',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#hashtag', '#summer', '#monday'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '13',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-23T23:00:00'),
        author: 'Никифоров Никита',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#hashtag', '#winter', '#monday'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '14',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-15T23:00:00'),
        author: 'Нистюк Александра',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#hashtag', '#summer', '#monday'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '15',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-02T23:00:00'),
        author: 'Подопригора Павел',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#hashtag', '#summer', '#monday'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '16',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-14T23:00:00'),
        author: 'Прищеп Максим',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#me', '#summer', '#friends'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '17',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-28T23:00:00'),
        author: 'Ястребова Вероника',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#me', '#summer', '#friends'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '18',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-05T23:00:00'),
        author: 'Дмитриев Дмитрий',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#me', '#summer', '#friends'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '19',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-14T23:00:00'),
        author: 'Егоров Егор',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattern.jpg',
        hashtags: ['#me', '#summer', '#friends'],
        likes: ['nick_name1', 'nick_name2']
    },
    {
        id: '20',
        description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
        createdAt: new Date('2018-02-15T23:00:00'),
        author: 'Степанов степан',
        photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg',
        hashtags: ['#me', '#summer', '#friends'],
        likes: ['nick_name1', 'nick_name2']
    }
];

let PostForAddWrongDescription = {
    id: '21',
    description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!' +
    'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!' +
    'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
    createdAt: new Date('2018-02-29T23:00:00'),
    author: 'Степанов степан',
    photoLink: 'http://ont.by/webroot/delivery/files/news/2018/02/22/Dom.jpg',
    hashtags: ['#summer', '#kek'],
    likes: ['nick_name1']
};

let PostForAddWithoutHashtags = {
    id: '22',
    description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
    createdAt: new Date('2018-02-14T23:00:00'),
    author: 'Степанов степан',
    photoLink: 'http://ont.by/webroot/delivery/files/news/2018/02/22/Dom.jpg',
    likes: ['nick_name1']
};

let PostForAddWithoutRequiredFields = {
    description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
    createdAt: new Date('2018-02-14T23:00:00'),
    photoLink: 'http://ont.by/webroot/delivery/files/news/2018/02/22/Dom.jpg',
    likes: ['nick_name1']
}

let PostForAddWithSameID = {
    id: '1',
    description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
    createdAt: new Date('2018-02-14T23:00:00'),
    author: 'Степанов степан',
    photoLink: 'http://ont.by/webroot/delivery/files/news/2018/02/22/Dom.jpg',
    likes: ['nick_name1']
}

let PostForAddWithWrongTypeOfFields = {
    id: '45',
    description: 'Женская сборная Беларуси выиграла эстафету в рамках соревнований по биатлону на Олимпийских играх в Пхёнчхане!!!',
    createdAt: new Date('2018-02-14T23:00:00'),
    author: 808,
    photoLink: 'http://ont.by/webroot/delivery/files/news/2018/02/22/Dom.jpg',
    likes: ['nick_name1']
}

let modul = (function () {

    photoPosts.sort(compareByDate);

    function compareByDate(photoPostA, photoPostB) {
        return Date.parse(photoPostB.createdAt) - Date.parse(photoPostA.createdAt);
    }

    function validTypeOfArray(array) {
        if (Array.isArray(array)) {
            return array.every(function (item) {
                return typeof (item) === 'string';
            });
        }
        return false;
    }

    let getPhotoPost = function (id) {
        return photoPosts.find(item => item.id === id);
    };

    let addPhotoPost = function (photoPost) {
        if (validatePhotoPost(photoPost)) {
            photoPosts.push(photoPost);
            photoPosts.sort(compareByDate);
            return true;
        }
        return false;
    };

    let checkSpace = function (array) {
        for (let i = 0; i < array.length; i++) {
            for (let j = 0; j < array[i].length; j++) {
                if (array[i].charAt(j) === ' ') {
                    return false;
                }
            }
        }

        return true;
    }

    let validHashtags = function (array) {
        if (Array.isArray(array)) {
            return array.every(function (item) {
                return item.charAt(0) === '#' && checkSpace(array);
            });
        }

        return false;
    }

    let validatePhotoPost = function (photoPost, flag) {

        if (!photoPost) {
            return false;
        }

        if (typeof (photoPost.description) === 'undefined' || typeof (photoPost.description) !== 'string' || photoPost.description.length > 200) {
            return false;
        }

        if (typeof (photoPost.photoLink) === 'undefined' || typeof (photoPost.photoLink) !== 'string' || photoPost.photoLink.length === 0) {
            return false;
        }

        if (!(typeof (photoPost.hashtags) === 'undefined' || validTypeOfArray(photoPost.hashtags))) {
            return false;
        }

        if (typeof (photoPost.hashtags) !== 'undefined' && !validHashtags(photoPost.hashtags)) {
            return false;
        }

        if (!flag) {
            if (typeof (photoPost.id) === 'undefined' || photoPosts.findIndex(item => item.id === photoPost.id) !== -1 || typeof (photoPost.id) !== 'string') {
                return false;
            }
        }

        if (typeof (photoPost.createdAt) === 'undefined' || photoPost.createdAt == 'Invalid Date') {
            return false;
        }

        if (typeof (photoPost.author) !== 'string' || photoPost.author.length === 0) {
            return false;
        }

        if (!validTypeOfArray(photoPost.likes)) {
            return false;
        }
        return true;
    };

    let removePhotoPost = function (id) {
        let index = photoPosts.findIndex(item => item.id === id);
        if (index !== -1) {
            photoPosts.splice(index, 1);
            return true;
        }
        return false;
    }

    let editPhotoPost = function (id, photoPost) {

        var clone = {};

        var tmp = photoPosts[photoPosts.findIndex(item => item.id === id)];

        for (var key in tmp) {
            clone[key] = tmp[key];
        }

        if (typeof (clone) === 'undefined') {
            return false;
        }

        if (photoPost.description) {
            clone.description = photoPost.description;
        }
        if (photoPost.photoLink) {
            clone.photoLink = photoPost.photoLink;
        }
        if (photoPost.hashtags) {
            clone.hashtags = photoPost.hashtags;
        }

        let flag = 'change';

        if (!validatePhotoPost(clone, flag)) {
            return false;
        }

        photoPosts[photoPosts.findIndex(item => item.id === id)] = clone;
        return true;
    };

    let getPhotoPosts = function (skip, top, filterConfig) {

        let posts = photoPosts;

        if (typeof (skip) !== 'number') {
            skip = 0;
        }

        if (typeof (top) !== 'number') {
            top = 10;
        }
        if (filterConfig) {
            if (filterConfig.author && (typeof (filterConfig.author) !== 'string' || filterConfig.author.length === 0) ||
                filterConfig.createdAt && filterConfig.Date == 'Invalid Date' ||
                filterConfig.hashtags && !validTypeOfArray(filterConfig.hashtags) && !validHashtags(filterConfig.hashtags)) {
                return [];
            }
            if (filterConfig.author) {
                posts = posts.filter(function (item) {
                    return item.author === filterConfig.author;
                });
            }

            if (filterConfig.createdAt) {
                posts = posts.filter(function (item) {
                    return Date.parse(item.createdAt) > Date.parse(filterConfig.createdAt);
                });
            }

            if (filterConfig.hashtags) {
                posts = posts.filter(function (postItem) {
                    if (typeof (postItem.hashtags) === 'undefined') {
                        return false;
                    }
                    return filterConfig.hashtags.every(function (item) {
                        return postItem.hashtags.includes(item);
                    })
                })
            }
        }
        posts = posts.slice(skip, skip + top);
        return posts;
    };

    return {
        getPhotoPost,
        getPhotoPosts,
        addPhotoPost,
        editPhotoPost,
        removePhotoPost
    }
})();

console.log('array of photoposts:')
console.log(photoPosts);

console.log('\n\ncheck mehtod getPhotoPost');
console.log("getPhotopost('3')");
console.log(modul.getPhotoPost('3'));
console.log("getPhotopost('2')");
console.log(modul.getPhotoPost('2'));
console.log('getPhotopost(100) no such id');
console.log(modul.getPhotoPost('100'));
console.log("getPhotopost(['1', '4']) wrong type of arg");
console.log(modul.getPhotoPost(['1', '4']));
console.log('getPhotopost() no args');
console.log(modul.getPhotoPost());


console.log('\n\ncheck method addPhotoPost');
console.log('post with wrong description');
console.log(modul.addPhotoPost(PostForAddWrongDescription));
console.log('post without hashtags');
console.log(modul.addPhotoPost(PostForAddWithoutHashtags));
console.log('post without required fields');
console.log(modul.addPhotoPost(PostForAddWithoutRequiredFields));
console.log('post with same id');
console.log(modul.addPhotoPost(PostForAddWithSameID));
console.log('post with wrong type of fields');
console.log(modul.addPhotoPost(PostForAddWithWrongTypeOfFields));
console.log('no args');
console.log(modul.addPhotoPost());

console.log('\n\narray of photoposts after:')
console.log(photoPosts);

console.log('\n\ncheck method remove photopost');
console.log('removePhotopost(2)');
console.log(modul.removePhotoPost('2'));
console.log('removePhotopost(7)');
console.log(modul.removePhotoPost('7'));
console.log('removePhotopost(200) no such ID');
console.log(modul.removePhotoPost(200));
console.log('removePhotopost([1, 1]) wrong type of arg');
console.log(modul.removePhotoPost([1, 1]));
console.log('removePhotopost() no args');
console.log(modul.removePhotoPost());

console.log('\n\narray of photoposts after:')
console.log(photoPosts);

console.log('\n\ncheck method editPhotoPost');
console.log("edit id=1 description: 'new description', hashtags: ['#night', '#summer']");
console.log(modul.editPhotoPost('1', {description: 'new description', hashtags: ['#night', '#summer']}));
console.log("edit id=1 description: 2, hashtags: ['#summer']");
console.log(modul.editPhotoPost('1', {description: 2, hashtags: ['#summer']}));
console.log("edit id=56(not exist) description: 'new description', hashtags: ['#summer']");
console.log(modul.editPhotoPost('56', {description: 'new description', hashtags: ['#summer']}));
console.log("edit id=3 description: 'new description', hashtags: ['#summer', '#sky', '#holidays']");
console.log(modul.editPhotoPost('3', {description: 'new description', hashtags: ['#summer', '#sky', '#holidays']}));
console.log("modul.editPhotoPost('6', { description: 'a', photoLink: 2 })");
console.log(modul.editPhotoPost('6', {description: 'a', photoLink: 2}));
console.log("modul.editPhotoPost('5', { description: 'a', hashtags: ['#summer', '#sky', '#holidays', '#friends'], photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg' })");
console.log(modul.editPhotoPost('5', {
    description: 'a',
    hashtags: ['#summer', '#sky', '#holidays', '#friends'],
    photoLink: 'https://raw.githubusercontent.com/prischepMA/PrischepFPMI/master/UI/img/pattent2.jpg'
}));

console.log('\n\narray of photoposts after:');
console.log(photoPosts);

console.log('\n\ncheck method getPhotoPosts');
console.log('getPhotoPosts(3, 3):')
console.log(modul.getPhotoPosts(3, 3));
console.log('getPhotoPosts(10, 7):')
console.log(modul.getPhotoPosts(10, 7));
console.log("getPhotoPosts(0, 7,{ createdAt: new Date('2018-02-10') }):");
console.log(modul.getPhotoPosts(0, 7, {createdAt: new Date('2018-02-10')}));
console.log("wrong date getPhotoPosts(1, 3,{ createdAt: 'k' }):");
console.log(modul.getPhotoPosts(1, 3, {createdAt: 'k'}));
console.log("getPhotoPosts((0, 20, { createdAt: new Date('2017-01-11'), author: 'Гаврушко Дмитрий' })):");
console.log(modul.getPhotoPosts(0, 20, {createdAt: new Date('2017-01-11'), author: 'Гаврушко Дмитрий'}));
console.log("no such hashtag getPhotoPosts((0, 10, { hashtags: ['#h'] ");
console.log(modul.getPhotoPosts(0, 10, {hashtags: ['#h']}));
console.log("getPhotoPosts((0, 10, { hashtags: ['#summer']");
console.log(modul.getPhotoPosts(0, 10, {hashtags: ['#summer']}));
console.log('wrong type of hashtags getPhotoPosts((0, 10, { hashtags: 4 }');
console.log(modul.getPhotoPosts(0, 10, {hashtags: 4}));
console.log('wrong type of author getPhotoPosts((0, 10, { author: [] }');
console.log(modul.getPhotoPosts(0, 10, {author: []}));
console.log("getPhotoPosts((0, 20, { createdAt: new Date('2018-02-14'), author: 'Прищеп Максим', hashtags: ['#summer', '#me'] }");
console.log(modul.getPhotoPosts(0, 20, {
    createdAt: new Date('2018-02-14'),
    author: 'Прищеп Максим',
    hashtags: ['#summer', '#me']
}));
console.log("wrong skip/top getPhotoPosts((10, 'd',{ hashtags: ['#summer'] }");
console.log(modul.getPhotoPosts(10, 'd', {hashtags: ['#summer']}));
console.log("wrong skip/top getPhotoPosts('d', 5,({ hashtags: ['#summer', '#hashtag'] }");
console.log(modul.getPhotoPosts('d', 5, {hashtags: ['#summer', '#hashtag']}));
console.log("wrong skip/top getPhotoPosts(('h', 'k', { hashtags: ['#summer', '#hashtag'] }");
console.log(modul.getPhotoPosts('h', 'k', {hashtags: ['#summer', '#hashtag']}));
console.log("wrong skip/top getPhotoPosts((null, null, { hashtags: ['#summer', '#hashtag'] }");
console.log(modul.getPhotoPosts(null, null, {hashtags: ['#summer', '#hashtag']}));